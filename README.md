# クラムシェルモード自動切替 (AutoLidModeSwitcher)

## 概要

このアプリケーションは、Windowsノートパソコンで使用する際に、蓋を閉じたときの**AC電源接続時の**動作を、現在のPCの電源状態（ACアダプタ接続時またはバッテリー駆動時）に応じて自動的に切り替えるユーティリティです。

クラムシェルモード（外部ディスプレイに接続し、ノートPCの蓋を閉じて使用する形態）では蓋を閉じてもスリープしない設定が望ましいですが、そのままバッテリー駆動に切り替わると意図せずバッテリーを消費する可能性があります。本アプリケーションは、このような状況に対応するために開発されました。

**重要な注意点:** 本アプリケーションは、Windowsの電源オプションのうち「**電源に接続しているとき**」の「カバーを閉じたときの動作」のみを変更します。「バッテリーで駆動しているとき」の「カバーを閉じたときの動作」は一切変更しません。

## 主な機能

* **自動設定モード:**
    * **PCがACアダプタに接続された場合:** Windowsの電源オプションにおける「AC電源接続時」の「カバーを閉じたときの動作」を自動的に「**何もしない**」に設定します（クラムシェルモードに適した設定）。
    * **PCがバッテリー駆動に切り替わった場合:** Windowsの電源オプションにおける「AC電源接続時」の「カバーを閉じたときの動作」を自動的に「**スリープ**」に設定します（意図しないバッテリー消費を防ぐための設定）。
* **手動設定モード:**
    * タスクトレイアイコンの右クリックメニューから、一時的に「AC電源接続時」の蓋閉じ動作を「何もしない」または「スリープ」に手動で設定できます。
    * 手動モードは、次にPCの電源状態が変化するか、メニューから「自動設定に戻す」を選択するまで維持されます。
* **Windows起動時に自動起動:**
    * 右クリックメニューから、Windows起動時に本アプリケーションを自動的に起動するかどうかを設定できます。
* **状態表示:**
    * タスクトレイアイコンの表示が、現在の動作モード（自動設定／手動設定中）に応じて変化します。
    * 右クリックメニューには、現在の動作モードが表示されます。
* **タスクトレイ常駐:**
    * アプリケーションはタスクトレイに常駐し、バックグラウンドで動作します。

## 動作環境

* Windows 10 / 11
* .NET 8.0 デスクトップ ランタイム (またはそれ以降)
* 管理者権限（`powercfg.exe` を実行して電源設定を変更するため）

## インストールとアンインストール

### インストール

1.  配布されたファイル群（`AutoLidModeSwitcher.exe` および関連ファイル: `.dll`, `.deps.json`, `.runtimeconfig.json`）を、任意のフォルダにコピーします。
2.  `AutoLidModeSwitcher.exe` を実行します。
3.  アプリケーションは起動時に管理者権限を要求するため、UACプロンプトが表示されますので、「はい」を選択して許可してください。
4.  タスクトレイにアイコンが表示されれば起動完了です。
5.  必要に応じて、右クリックメニューから「Windows起動時に自動起動する」にチェックを入れてください。

### アンインストール

1.  本アプリケーションが起動している場合は、タスクトレイアイコンを右クリックし、「終了」を選択してアプリケーションを終了します。
2.  「Windows起動時に自動起動する」設定を有効にしていた場合は、右クリックメニューからチェックを外して無効にしてください（または、レジストリエディタで `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run` から `AutoLidModeSwitcher` のエントリを削除してください）。
3.  アプリケーションのファイル群をコピーしたフォルダごと削除してください。

## 使用方法

1.  アプリケーションを起動すると、タスクトレイにアイコンが表示されます。
2.  アイコンを右クリックすると、以下の操作が可能なメニューが表示されます。
    * **モード表示:** 現在の動作モード（自動設定／手動設定中）を確認できます。
    * **自動設定に戻す:** 手動設定モードの場合に、現在のPCの電源状態に応じた自動設定モードに戻します。
    * **AC電源時: 何もしない:** 「AC電源接続時」の蓋閉じ動作を「何もしない」に手動で設定します。
    * **AC電源時: スリープ:** 「AC電源接続時」の蓋閉じ動作を「スリープ」に手動で設定します。
    * **Windows起動時に自動起動:** オンにすると、Windows起動時に本アプリケーションが自動的に起動します。
    * **終了:** アプリケーションを終了します。
3.  PCの電源状態（ACアダプタの抜き差し）が変化すると、アプリケーションは自動的に「AC電源接続時」の蓋閉じ設定を適切な状態に変更し、タスクトレイに通知を表示します。

## 注意事項

* 本アプリケーションは、Windowsの電源設定を変更するために管理者権限で動作します。
* **本アプリケーションは、「バッテリーで駆動しているとき」の蓋閉じ設定は一切変更しません。** この設定は、必要に応じてWindowsの電源オプションから別途行ってください。
* アイコンファイル（`icon_auto.ico`, `icon_manual.ico`）がアプリケーションのリソースとして正しく含まれていない場合、アイコン表示に問題が生じる可能性があります。

## 開発者

na0k106ata

## 謝辞

このアプリケーションの開発は、GoogleのAIモデルであるGemini 2.5 Proのサポートを受けて行われました。

## バージョン

1.2.0 (2025-05-23)

## ライセンス

MIT License
